import{d as tt,h as T,s as be,y as nt,i as ot,j as st,k as Q,c as S,g as V,t as N,u as h,b as d,F as it,a as rt,l as F,m as ee,z as ge,v as at,o as p,A as lt,p as ct,q as ut,_ as ht}from"./index-7eaccc1f.js";import{R as L,o as dt,S as te,e as w,q as C,c as mt,s as ne,t as ft,v as Se,T as vt,h as bt}from"./websocket-93f296e7.js";import{u as gt}from"./casinoStore-cbc67f66.js";import{h as P,g as O,u as Y,k as $,i as St,l as pt,m as Ct}from"./chips-29ef6051.js";import{j as yt,u as x,e as Be,p as H,s as xt,t as pe,v as Pt,w as _t,f as Bt,x as M,y as Tt,z as Nt,A as Ce}from"./commonPainter-b21e1c8f.js";const ye=2*Math.PI,xe=(e,t)=>(Te(e,t),e>=t),Pe=(e,t)=>(Te(e,t),e<=t),Te=(e,t)=>{if(e<0||t<0)throw new Error("value is missing="+e+" : "+t)},le=(e,t,s)=>{try{if(!xe(e.x,t.x)||!Pe(e.x,s.x)||!xe(e.y,t.y)||!Pe(e.y,s.y))return!1}catch(i){return console.error("error "+i),!1}return!0},oe=e=>e||0;let _e,A,_,G,j,ie,re,ae=7,Rt=14,Ne={x:96,y:20},Et={x:730,y:434},E={x:Ne.x,y:264},U={x:730,y:434},R,q,Re,Ee,f;const wt=(e,t)=>{if(e.getContext("2d")===null)throw new Error("no data.canvas ctx");_e=e.width*.837,Re=e.width*.12,Ee=e.height*.034,e.width*.12,e.height*.034,A=_e/13,_=A*1.5,G=.9*_,j=.9*A,ie=G/3,re=j/3,R=(Et.x-Ne.x)/6,q=R*.75,f=t,Ot(),It(),kt(),zt()},se=(e,t)=>{const s={x:t.offsetX,y:t.offsetY};let i;if(Le(s)){if(we(s)){let o=e.filter(r=>r.number>=200&&r.number<=203);for(let r=0;r<3;r++)s.x>=o[r].selectSection.startCorner.x&&(i=o[r]);return i}else if(Lt(s)){let o=e.filter(r=>r.number>=203&&r.number<=208);for(let r=0;r<6;r++)s.x>=o[r].selectSection.startCorner.x&&(i=o[r]);return i}}else if(At(s))return i=e.find(o=>le(s,o.selectSection.startCorner,o.selectSection.endCorner)),i},we=e=>{const t=(U.y-E.y)/2+E.y;return e.x>=E.x&&e.y>=E.y&&e.x<U.x&&e.y<t},Lt=e=>Le(e)&&!we(e),Le=e=>e.x>=E.x&&e.y>=E.y&&e.x<U.x&&e.y<U.y,At=e=>{const t=f[0].selectSection;return le(e,t.startCorner,t.endCorner)?!0:e.x>=E.x&&e.y<E.y};function It(){const e=f.find(i=>i.number===1);let t=P(e.selectSection.startCorner,_),s=36;for(let i=0;i<24;i++)if(i%2==0){let o=t.x+i*A/2+i*ae-ie/2-i*5;i>3&&(o=o-3),i>6&&(o=o-6);for(let r=0;r<6;r++){s++;const m=t.y-r*_/2-re/2-(r>2?9:0),u=f.find(c=>c.number===s);u.selectSection={startCorner:{x:o,y:m},endCorner:{x:o+15,y:m+15}},u.highlightSection=u.selectSection}}else{let o=t.x+i*A/2+i*ae-ie/2-i*5;for(let r=0;r<3;r++){s++;const m=t.y-r*_-re/2-(r>1?9:0),u=f.find(c=>c.number===s);u.selectSection={startCorner:{x:o,y:m},endCorner:{x:o+15,y:m+15}},u.highlightSection=u.selectSection}}}function Ot(){let e=0;for(let s=0;s<12;s++){const i=s*(j+ae)+Re;for(let o=3;o>0;o--){e++;const r=(o-1)*(G+Rt)+Ee,m={x:i,y:r},u=f.find(c=>c.number===e);u.selectSection={startCorner:{x:m.x,y:m.y},endCorner:{x:m.x+j,y:m.y+G}},u.highlightSection=u.selectSection}}const t=f.find(s=>s.number===0);t.selectSection={startCorner:{x:30,y:20},endCorner:{x:90,y:260}},t.highlightSection=t.selectSection}function kt(){const e=f.find(o=>o.number===34),t=f.find(o=>o.number===145);t.selectSection={startCorner:{x:(e==null?void 0:e.selectSection.startCorner.x)+A,y:e.selectSection.startCorner.y},endCorner:{x:(e==null?void 0:e.selectSection.endCorner.x)+A,y:e.selectSection.endCorner.y}},t.highlightSection=t.selectSection;const s=f.find(o=>o.number===146);s.selectSection={startCorner:{x:t.selectSection.startCorner.x,y:t.selectSection.startCorner.y-_},endCorner:{x:t.selectSection.endCorner.x,y:t.selectSection.endCorner.y-_}},s.highlightSection=s.selectSection;const i=f.find(o=>o.number===147);i.selectSection={startCorner:{x:s.selectSection.startCorner.x,y:s.selectSection.startCorner.y-_},endCorner:{x:s.selectSection.endCorner.x,y:s.selectSection.endCorner.y-_}},i.highlightSection=i.selectSection}const zt=()=>{const e=f.find(o=>o.number===1),t=f.find(o=>o.number===200);t.selectSection={startCorner:P(e.selectSection.startCorner,q+5),endCorner:O(e.selectSection.startCorner,2*R,2*q)},t.highlightSection=t.selectSection;let s=200;for(let o=0;o<3;o++){const r=f.find(m=>m.number===s);r.selectSection={startCorner:Y(t.selectSection.startCorner,2*o*R),endCorner:Y(t.selectSection.endCorner,2*R*o)},r.highlightSection=r.selectSection,s++}s=203;const i=f.find(o=>o.number===203);P(t.selectSection.startCorner,q),i.selectSection={startCorner:P(t.selectSection.startCorner,q+5),endCorner:O(t.selectSection.startCorner,R,2*q)};for(let o=0;o<6;o++){const r=f.find(m=>m.number===s);r.selectSection={startCorner:Y(i.selectSection.startCorner,o*R),endCorner:Y(i.selectSection.endCorner,o*R)},r.highlightSection=r.selectSection,s++}};let n;const X={x:32,y:32},I={x:38,y:38},Ft=()=>n.recalculate;function Mt(e){if(e.canvas.getContext("2d")===null)throw new Error("no canvas to paint");n=e,Ft()&&wt(e.canvas,e.betPositions),yt(e.canvas),Kt(),jt(),qt(),Ht(),Zt(),Yt()}const qt=()=>{!n.hero||!n.hero.chips||(Gt(),Ut(),Xt(),Dt(),Vt(),Wt())},Wt=()=>{var e;if((e=n.hero)!=null&&e.positionsTotalAmounts)for(const[t,s]of Object.entries(n.hero.positionsTotalAmounts)){const i=n.betPositions.find(r=>r.number===Number(t)),o=O(i.highlightSection.startCorner,I.x/6,25);x(n.canvas,o,s.toString(),_t)}},Vt=()=>{n.table.gamePhase===L.BET&&x(n.canvas,{x:n.canvas.width/2,y:n.canvas.height*.85},"Place bets",Bt)},Yt=()=>{if(n.randomNumber===null)return;const e=n.betPositions.find(s=>s.number===n.randomNumber);if(!e)return;const t=$(e.selectSection.endCorner,e.selectSection.startCorner);Be(n.canvas,e.selectSection.startCorner,t,!0)},Ht=()=>{if(n.table.gamePhase!==L.BET||!n.hero.selectedChip||!n.hero.selectedChip.position)return;n.highlightEffectiveNumbers?$t():Jt()},Dt=()=>{!n.hero||!n.hero.bets||n.hero.bets.forEach((e,t)=>{var o;const s=(o=n.betPositions.find(r=>r.number===e.position))==null?void 0:o.selectSection.startCorner;let i=Y(s,t*3);s.x<i.x+I.x&&(i=s),H(n.canvas,pt.image,i,I)})},Xt=()=>{const e={x:2,y:n.canvas.height/2};x(n.canvas,e,"balance ",M),x(n.canvas,P(e,25),oe(n.hero.currentBalance).toString(),M),x(n.canvas,P(e,50),"on bets ",M),x(n.canvas,P(e,75),oe(n.hero.totalBet).toString(),M),x(n.canvas,P(e,100),"on table ",M),x(n.canvas,P(e,125),oe(n.hero.totalOnTable).toString(),M)},Gt=()=>{if(!n.hero.chips||n.table.gamePhase!==L.BET)return;let e=0;n.hero.chips.forEach(t=>{const s={x:n.canvas.width-1.5*X.x,y:n.canvas.height*.7-X.y*e};t.position=s,t.size=X,H(n.canvas,t.image,s,X),x(n.canvas,O(s,5,23),t.value.toString(),Tt),e++})},jt=()=>{n.table.seats.filter(t=>{var s;return!t.available&&t.player.userName!==((s=n.hero)==null?void 0:s.userName)}).map(t=>t.player).forEach(t=>{t.bets.forEach(s=>{var o;const i=(o=n.betPositions.find(r=>r.number===s.position))==null?void 0:o.selectSection.startCorner;H(n.canvas,St.image,i,O(I,-I.x/8,-I.y/8))})})},Ut=()=>{!n.hero.selectedChip||!n.hero.selectedChip.position||H(n.canvas,n.hero.selectedChip.image,n.hero.selectedChip.position,I)},$t=()=>{n.selectedBetPosition&&n.selectedBetPosition.tableNumbers.forEach(e=>{const t=n.betPositions.find(i=>i.number===e),s=$(t.selectSection.endCorner,t.selectSection.startCorner);xt(n.canvas,t.selectSection.startCorner,s,Nt)})},Jt=()=>{if(!n.selectedBetPosition)return;const e=$(n.selectedBetPosition.highlightSection.endCorner,n.selectedBetPosition.highlightSection.startCorner);Be(n.canvas,n.selectedBetPosition.highlightSection.startCorner,e,!0)},Zt=()=>{const e=n.highlightNumber;if(e&&e>=0&&e<=36){const t=n.betPositions.find(o=>o.number===n.highlightNumber),s=$(t.selectSection.endCorner,t.selectSection.startCorner),i={x:t.selectSection.startCorner.x+s.x/2,y:t.selectSection.startCorner.y+s.y/2};pe(n.canvas,i,33,{x:0,y:ye},Ce)}else e===0&&pe(n.canvas,{x:56,y:140},37,{x:0,y:ye},Ce)},Kt=()=>{H(n.canvas,Pt,{x:0,y:0},{x:n.canvas.width,y:n.canvas.height*.75})},k=e=>(ct("data-v-7c2419e3"),e=e(),ut(),e),Qt={style:{position:"relative"}},en={class:"resultBoard"},tn={class:"results"},nn={key:0,class:"counter"},on=k(()=>d("canvas",{id:"canvas",width:"800",height:"600"},null,-1)),sn={key:1,class:"roundResults"},rn=k(()=>d("br",null,null,-1)),an=k(()=>d("br",null,null,-1)),ln=k(()=>d("br",null,null,-1)),cn=k(()=>d("br",null,null,-1)),un={key:2,class:"highlightSelection"},hn=k(()=>d("label",{for:"highlightNumbers"}," Numbers ",-1)),dn=k(()=>d("label",{for:"highlightPosition"},"Position",-1)),mn={key:3,id:"takeSeatRow",class:"joinInfo"},fn={key:4,class:"joinInfo"},vn={style:{top:"-120px"}},bn=["disabled"],gn=["disabled"],Sn={key:5,style:{top:"-120px"}},pn={key:6,style:{top:"-120px"}},Cn=tt({__name:"RouletteTable",setup(e){const t=dt(),s=gt(),i=T(),o=T(null),r=T(null),m=T(!1),{table:u,mainCharacter:c,serverCommand:J}=be(t),{counter:ce}=be(s),Ae=T(),Ie=T(),W=T(!0);let Z,ue;const Oe=t.$subscribe((a,l)=>{a.type==="patch object"&&ke()}),ke=()=>{J.value===te.LOGIN?qe():J.value===te.ROUND_COMPLETED&&Fe(),c.value&&(u.value.gamePhase===L.BET?Ze():(c.value.selectedChip=void 0,i.value=void 0)),b(J.value===te.INIT_DATA)};nt(()=>t.getTable.gamePhase,a=>{a===L.SPINNING&&ze()});const ze=()=>{Z=setInterval(()=>{if(u.value.gamePhase!==L.SPINNING){clearInterval(Z),r.value=null,b(!1);return}r.value=Me(),b(!1)},400)},Fe=()=>{o.value=u.value.wheel.resultBoard[u.value.wheel.resultBoard.length-1].winningNumber,ue=setTimeout(()=>{o.value=null,b(!1)},6e3)},Me=()=>Math.floor(Math.random()*(u.value.tableCard.gameData.tableNumbers.max-u.value.tableCard.gameData.tableNumbers.min)+u.value.tableCard.gameData.tableNumbers.min),qe=()=>{B.value.addEventListener("pointermove",K,!1),B.value.addEventListener("pointerout",We,!1),B.value.addEventListener("pointerup",de,!1),window.addEventListener("contextmenu",he,!1)},he=a=>{a.preventDefault();const l=se(t.betPositions,a);l&&w({action:C.REMOVE_BET_FROM_POSITION,position:l.number})},K=a=>{Ae.value=a.offsetX,Ie.value=a.offsetY,Ve(a),Ue(a)},We=()=>{c.value.selectedChip=void 0,b(!1)},Ve=a=>{var y;if(!((y=c.value)!=null&&y.chips))return;const l={x:a.offsetX,y:a.offsetY};for(const v of c.value.chips){const D=O(v.position,v.size.x,v.size.y);if(le(l,v.position,D)){c.value.selectedChip={value:v.value,position:{x:a.offsetX,y:a.offsetY},image:v.image,size:v.size};break}}if(c.value.selectedChip){const v=O(l,-c.value.selectedChip.size.x/2,-c.value.selectedChip.size.y/2);c.value.selectedChip.position=v,b(!1)}},de=a=>{if(!Ye())return;const l=se(t.betPositions,a);l&&w({action:C.BET,position:l.number,amount:c.value.selectedChip.value})},Ye=()=>!!c.value.selectedChip,He=()=>w({action:C.REMOVE_LAST_OR_ALL,removeAllBets:!1}),De=()=>w({action:C.REMOVE_LAST_OR_ALL,removeAllBets:!0}),Xe=()=>{o.value=null,w({action:C.PLAY,spinId:u.value.wheel.spinId}),b(!1)},Ge=()=>w({action:C.REPEAT_LAST}),je=()=>w({action:C.FETCH_BET_POSITIONS}),B=T(mt()),Ue=a=>{const l=se(t.betPositions,a);l!==i.value&&(Je(),l&&$e(l),b(!1))},$e=a=>{i.value=a,i.value.selected=!0},Je=()=>{i.value&&(i.value.selected=!1),i.value=void 0};ot(()=>{B.value=document.getElementsByTagName("canvas")[0],m.value=!0,je()});const Ze=()=>{const a=u.value.tableCard.gameData.minBet,l=u.value.tableCard.gameData.maxBet;c.value.chips=Ct.filter(y=>y.value<=c.value.currentBalance&&y.value>=a&&y.value<=l)};st(()=>{clearTimeout(ue),clearInterval(Z),Oe(),bt(),Ke(),t.$reset()});const Ke=()=>{B.value.removeEventListener("pointermove",K,!1),B.value.removeEventListener("pointermove",K,!1),B.value.removeEventListener("pointerup",de,!1),window.removeEventListener("contextmenu",he,!1)},b=a=>{const l={table:u.value,betPositions:t.betPositions,canvas:B.value,hero:t.mainCharacter,recalculate:a,selectedBetPosition:i.value,highlightEffectiveNumbers:W.value,highlightNumber:o.value,randomNumber:r.value};Mt(l)},Qe=a=>a===0?"green":t.getRedNumbers.includes(a)?"red":"black",z=Q(()=>{var a,l;return((l=(a=c.value)==null?void 0:a.roundResults)==null?void 0:l.length)>0?c.value.roundResults[c.value.roundResults.length-1]:void 0}),me=Q(()=>{var a,l;return(l=(a=c.value)==null?void 0:a.actions)==null?void 0:l.includes(C.REMOVE_LAST_OR_ALL)}),et=Q(()=>ce.value>=0&&u.value.type===vt.MULTIPLAYER&&u.value.gamePhase===L.BET);return(a,l)=>{var y,v,D,fe,ve;return p(),S("div",Qt,[V(" Welcome "+N((y=h(c))==null?void 0:y.userName)+" ",1),d("div",en,[d("ul",tn,[(p(!0),S(it,null,rt(h(t).getReversedResultBoard,g=>(p(),S("li",{class:lt(Qe(g.winningNumber))},"   "+N(g.winningNumber)+", ",3))),256))])]),et.value?(p(),S("div",nn,N(h(ce)),1)):F("",!0),on,z.value?(p(),S("section",sn,[d("header",null," Results of round "+N(z.value.spinResult.roundNumber),1),V(" Winning number = "+N(z.value.spinResult.winningNumber),1),rn,V(" Winnings = "+N(z.value.playerResult.totalWinnings)+" ",1),an,V(" RemainingBets = "+N(z.value.playerResult.totalRemainingBets),1),ln,V(" Played bets = "+N(z.value.playerResult.totalBets),1),cn])):F("",!0),h(ne)(h(u),h(c))?(p(),S("div",un,[ee(d("input",{type:"radio",id:"highlightNumbers",value:!0,onClick:l[0]||(l[0]=g=>b(!1)),"onUpdate:modelValue":l[1]||(l[1]=g=>W.value=g)},null,512),[[ge,W.value]]),hn,ee(d("input",{type:"radio",id:"highlightPosition",value:!1,onChange:l[2]||(l[2]=g=>b(!1)),"onUpdate:modelValue":l[3]||(l[3]=g=>W.value=g)},null,544),[[ge,W.value]]),dn])):F("",!0),h(ft)(h(u),h(c))?(p(),S("div",mn,[d("button",{onClick:l[4]||(l[4]=(...g)=>h(Se)&&h(Se)(...g))}," JOIN TABLE ")])):h(ne)(h(u),h(c))?F("",!0):(p(),S("div",fn," Cannot play in this table. ")),ee(d("div",vn,[d("button",{disabled:!me.value,onClick:De},"Remove bets",8,bn),d("button",{disabled:!me.value,onClick:He},"Remove last bet",8,gn)],512),[[at,h(ne)(h(u),h(c))]]),(D=(v=h(c))==null?void 0:v.actions)!=null&&D.includes(h(C).PLAY)?(p(),S("span",Sn,[d("button",{onClick:Xe},"Play")])):F("",!0),(ve=(fe=h(c))==null?void 0:fe.actions)!=null&&ve.includes(h(C).REPEAT_LAST)?(p(),S("span",pn,[d("button",{onClick:Ge},"Repeat last")])):F("",!0)])}}});const Tn=ht(Cn,[["__scopeId","data-v-7c2419e3"]]);export{Tn as default};
