import{S as T,a as O,T as Pe}from"./websocket-cc29c7ee.js";import{a as Ae,C as V}from"./blackjackMessageHandler-a072c78d.js";import{n as _e,E as W,G as we,H as Re,I as Le,J as h,t as v,A as Oe,B as C,u as l,K as Y,L as g,F as We,v as He,w as E,p as x,C as Ue,D as Me}from"./router-ca7b6956.js";import{_ as ze}from"./_plugin-vue_export-helper-c27b6911.js";var b=(e=>(e.TAKE="TAKE",e.DOUBLE_DOWN="DOUBLE_DOWN",e.STAND="STAND",e.SPLIT="SPLIT",e.INSURE="INSURE",e.BET="BET",e))(b||{}),k=(e=>(e.INSURE="INSURE",e.BET="BET",e.ROUND_COMPLETED="ROUND_COMPLETED",e))(k||{});const D={color:"blue",faceAndSize:"20px Arial"},re={color:"E97451",faceAndSize:"22px Arial"},ae=76,se=107.2,$e=21,Ve=34.6,Ye={x:ae,y:se};function je(e){const t={x:Fe(e),y:Ke(e)},r=t.x*ae+$e*t.x,n=t.y*se+Ve*t.y+.7;return{position:{x:r,y:n},size:Ye}}const Fe=e=>{if(e.rank<8){if(e.suit===T.HEART)return 0;if(e.suit===T.DIAMOND)return 1;if(e.suit===T.CLUB)return 2;if(e.suit===T.SPADE)return 3}return e.suit===T.HEART?4:e.suit===T.DIAMOND?5:e.suit===T.CLUB?6:7},Ke=e=>e.rank===1||e.rank===8?0:e.rank===2||e.rank===9?1:e.rank===3||e.rank===10?2:e.rank===4||e.rank===11?3:e.rank===5||e.rank===12?4:e.rank===6||e.rank===13?5:6,Xe=document.getElementById("cardsSprite"),Je=document.getElementById("bgImage"),U="-",oe=1500;let f,p;const j=.72;let N,K;const F=6;function qe(e){const t=document.documentElement.clientWidth;e.width=t>800?800:t,e.height=document.documentElement.clientHeight>800?800:document.documentElement.clientHeight}function Qe(e,t,r){X(r,t,e),r.getContext("2d")&&(!t||Object.keys(t).length===0||(lt(t,r,ce(e,t)),ot(t.seatNumber,e,r),it(e,r)))}function Ze(e,t,r){X(r,t,e);const n=ie(e);n.length!==0&&(et(n,t,r),Ge(e,r),le(n,t,r))}const Ge=(e,t)=>{e.dealerHand.cards.forEach((r,n)=>{J(U,r,n,0,t)})},et=(e,t,r)=>{e.forEach(n=>{n.hands.forEach((a,i)=>{a.cards.forEach((u,m)=>{J(n.userName,u,m,i,r)})})})};async function tt(e,t,r){if(!r.getContext("2d"))return;X(r,t,e);const a=ie(e);te(a,r);const i=e.dealerHand.cards[0];await ue(oe,U,i,0,0,r),te(a,r),le(a,t,r)}const ie=e=>e.seats.map(t=>t.player).filter(t=>{var r;return(t==null?void 0:t.hands)&&((r=t.hands[0])==null?void 0:r.cards.length)>0}),te=async(e,t)=>{for(let r=0;r<e.length;r++){const n=e[r],a=n.hands[0].cards.findIndex(m=>!m.hasOwnProperty("visible")),i=n.hands[0].cards[a],u=0;await ue(oe,n.userName,i,a,u,t),i.visible=!0}},le=(e,t,r)=>{for(const n of e){const a=me(n.userName),i=q(a,p,f);de(n.userName);const u=n.userName===t.userName?w.y:_.y;nt(n).forEach((m,c)=>{const I=i.y+u/2+u*c;m.values.length===1?S(m.values[0].toString(),{x:i.x+p-50,y:I},r,D):S(m.values[0].toString()+"/"+m.values[1].toString(),{x:i.x+p-50,y:I},r,D)})}},nt=e=>e?e.hands:[],rt=e=>new Promise(t=>setTimeout(t,e)),X=(e,t,r)=>{N=t,K=r,f=e.height/4,p=e.width/4},ue=async(e,t,r,n,a,i)=>{await rt(e),J(t,r,n,a,i)},J=(e,t,r,n,a)=>{const i=a.getContext("2d");if(!t||!i){console.error("cannot draw");return}const u=je(t),m=de(e),c=at(e,r,n);i.drawImage(Xe,u.position.x,u.position.y,u.size.x,u.size.y,c.x,c.y,m.x,m.y)};let H,_,w;const at=(e,t,r)=>{if(e===U){const m=p+t*H.x+20,c=f+f;return{x:m,y:c}}if(e===N.userName){const m=p+t*w.x+20,c=3*f+r*w.y;return{x:m,y:c}}const n=me(e);let a=q(n,p,f),i=a.x+_.x*t+2,u=a.y+a.y/3+r*_.y;return{x:i,y:u}},de=e=>{if(e===U){if(!H){const r=f*.65;H={x:r*j,y:r}}return H}const t=st(e);if(e===N.userName){if(!w){const r=t>0?f/2:f;w={x:r*j,y:r}}return w}if(!_){const r=t>0?f/2.5:f/1.5;_={x:r*j,y:r}}return _},st=e=>{var r;const t=(r=K.seats.find(n=>{var a;return((a=n.player)==null?void 0:a.userName)===e}))==null?void 0:r.player.hands.length;if(!t)throw new Error("no hand count");return t},ne=(e,t)=>{if(e===t.seats.length-1)return 0;let r=e;return r++,r},ot=(e,t,r)=>{if(!r.getContext("2d"))return;let a=ne(e,t);for(let i=0;i<t.seats.length;i++){const u=t.seats.find(m=>m.number===a);e!==u.number&&ut(q(i,p,f),u,r,ce(t,u.player)),a=ne(a,t)}},ce=(e,t)=>{var r;return t?t.userName===((r=e.playerInTurn)==null?void 0:r.userName):!1},me=e=>{if(N.userName===e)return F;const t=K.seats.find(r=>{var n;return((n=r.player)==null?void 0:n.userName)===e});if(!t)throw new Error("player not found "+e);return N.seatNumber>t.number?F-(N.seatNumber-t.number):t.number-N.seatNumber-1},q=(e,t,r)=>{let n={};return e===0?n={x:0,y:r}:e===1?n={x:0,y:0}:e===2?n={x:t,y:0}:e===3?n={x:2*t,y:0}:e===4?n={x:3*t,y:0}:e===5?n={x:3*t,y:r}:e===F&&(n={x:0,y:r*3}),n},it=(e,t)=>{if(!t.getContext("2d"))return;Q({x:p,y:f},{x:2*p,y:2*f},t,!1);const n="Dealer"+(e.dealerHand.values[0]>0?" has "+e.dealerHand.values[0].toString():"");S(n,{x:p+10,y:f+20},t,re)},lt=(e,t,r)=>{if(!t.getContext("2d"))return;Q({x:0,y:t.height*.75},{x:t.width,y:t.height},t,r),S(e.userName,{x:5,y:3*f+18},t,D),S("total "+e.balance,{x:5,y:3*f+35},t,re);const a=e.totalBet!=null?e.totalBet:0;S("bet "+a,{x:5,y:3*f+55},t,D)},ut=(e,t,r,n)=>{if(Q(e,{x:p,y:f},r,n),!t.player){S("Seat "+(t.number+1),{x:e.x+10,y:e.y+50},r,D);return}S(t.player.userName,{x:e.x+5,y:e.y+18},r,D),S("$"+t.player.balance,{x:e.x+5,y:e.y+35},r,D)},Q=(e,t,r,n)=>{const a=r.getContext("2d");if(!a)return;const i=a.strokeStyle,u=a.lineWidth;n&&(a.strokeStyle="green",a.lineWidth=10),a.strokeRect(e.x,e.y,t.x,t.y),a.strokeStyle=i,a.lineWidth=u},S=(e,t,r,n)=>{const a=r.getContext("2d");if(!a||!e)return;const i=a.font,u=a.fillStyle;a.font=n.faceAndSize,a.fillStyle=n.color,a.fillText(e,t.x,t.y),a.font=i,a.fillStyle=u},dt=e=>(Ue("data-v-c88ba4cc"),e=e(),Me(),e),ct={style:{position:"relative"}},mt=dt(()=>E("canvas",{id:"canvas",width:"1800",height:"600"},null,-1)),ft={key:1,id:"takeSeatRow"},yt=["id"],ht=["onClick"],vt=["disabled"],xt=["disabled"],pt=["disabled"],gt=["disabled"],bt=["disabled"],Ct=["disabled"],St={key:4,id:"actionRow",style:{position:"relative",bottom:"25px: left:50px"}},It=_e({__name:"BlackjackTableView",props:{tableId:null},setup(e){const t=W(!1),r=Ae(),{table:n,command:a,player:i,counter:u}=we(r),m=r.$subscribe((s,o)=>{s.type==="patch object"&&fe()}),c=W(0),I=W(0);Re(()=>{t.value=!0,qe(R()),z(!1)}),Le(()=>{m()});const fe=()=>{var o;if(z(n.value.gamePhase==="PLAY"&&a.value===V.INITIAL_DEAL_DONE),n.value.gamePhase!==k.ROUND_COMPLETED)return;c.value=0;const s=(o=n.value.seats.find(y=>{var d,A;return((d=y.player)==null?void 0:d.userName)===((A=i.value)==null?void 0:A.userName)}))==null?void 0:o.player;s&&(I.value=s.totalBet>n.value.tableCard.thresholds.maximumBet?n.value.tableCard.thresholds.maximumBet:s.totalBet)},ye=s=>{O({action:"JOIN",seat:s})},Z=h(()=>{var s;return u.value<=0||!t.value?"":n.value.gamePhase===k.ROUND_COMPLETED?"Next round starts in "+u.value:n.value.gamePhase===k.INSURE?"Insurance time left "+u.value:a.value===V.PLAYER_TIME_START||a.value===V.INITIAL_DEAL_DONE?"Player "+((s=n.value.playerInTurn)==null?void 0:s.userName)+" "+u.value:B.value?"Place your bets "+u.value:n.value.gamePhase===k.BET?"Bet phase "+u.value:""}),P=s=>{c.value=s,O({action:b.BET,amount:s}),i.value.totalBet=c.value,z(!1)},M=h(()=>{var s;return((s=i.value)==null?void 0:s.seatNumber)>=0}),he=h(()=>B.value&&c.value-n.value.tableCard.thresholds.minimumBet>=0),ve=h(()=>{var s;return B.value&&c.value>=0&&c.value+n.value.tableCard.thresholds.minimumBet<=n.value.tableCard.thresholds.maximumBet&&((s=i.value)==null?void 0:s.balance)-(c.value+n.value.tableCard.thresholds.minimumBet)>=0}),xe=h(()=>{var s;return B.value&&((s=i.value)==null?void 0:s.balance)>=n.value.tableCard.thresholds.minimumBet&&c.value!==n.value.tableCard.thresholds.minimumBet}),pe=h(()=>{var s;return B.value&&((s=i.value)==null?void 0:s.balance)>n.value.tableCard.thresholds.maximumBet}),B=h(()=>n.value.gamePhase===k.BET&&M.value&&u.value>0),ge=h(()=>{const s=n.value.tableCard;return s.type===Pe.MULTIPLAYER?!M.value&&n.value.seats.map(o=>o.available)!=null:s.availablePositions.length>=s.thresholds.seatCount}),be=h(()=>{var s;return n.value.gamePhase==="PLAY"&&n.value.playerInTurn.userName===((s=i.value)==null?void 0:s.userName)}),Ce=h(()=>B.value&&I.value>0&&(i==null?void 0:i.value.balance)>=I.value),Se=h(()=>c.value>0),Ie=()=>{ee.value=!0,O({action:b.INSURE})},L=s=>{O({action:s})},ke=h(()=>n.value.seats.sort((s,o)=>s.number-o.number)),R=()=>document.getElementById("canvas"),Be=()=>{const s=R(),o=s.getContext("2d");return o==null||o.clearRect(0,0,s.width,s.height),s},z=async s=>{const o=Be(),y=o.getContext("2d");y&&(y.drawImage(Je,0,0,o.width,o.height),Qe(n.value,$(),o),s?tt(n.value,$(),o):Ze(n.value,$(),o))},$=()=>{var o,y;return(o=i.value)!=null&&o.userName?i.value:(y=n.value.seats.find(d=>{var A;return((A=d.player)==null?void 0:A.balance)>0}))==null?void 0:y.player},G=s=>n.value.seats.some(o=>{var y;return((y=o.player)==null?void 0:y.seatNumber)>=0})?{display:"inline","margin-right":"45px",left:"50px"}:{display:"inline",bottom:"200px","margin-right":"45px",left:"50px"},Te=()=>({display:"inline",bottom:R().height/5+"px","margin-right":"45px",left:"75px"}),Ee=h(()=>{const s=(R().height*.72).toString()+"px",o=(R().width/3).toString()+"px",y=u.value>4?"yellow":"red";return{left:o,top:s,color:y,"font-size":22+"px","z-index":10}}),Ne=()=>i.value.hands.length===1?"Take":i.value.hands[0].active?"Take ( first )":"Take ( second )",ee=W(!1),De=h(()=>M.value&&n.value.gamePhase===k.INSURE&&i.value.balance>=i.value.totalBet/2&&ee.value===!1&&i.value.hands[0].cards.length>0);return(s,o)=>{var y;return x(),v("div",ct,[Oe(" Welcome "+C((y=l(i))==null?void 0:y.userName)+" ",1),l(Z)?(x(),v("div",{key:0,style:Y(l(Ee))},C(l(Z)),5)):g("",!0),mt,l(ge)?(x(),v("div",ft,[(x(!0),v(We,null,He(l(ke),d=>(x(),v("div",{key:d.number,id:d.number.toString(),style:Y(G(d.number))},[d.available?(x(),v("button",{key:0,onClick:A=>ye(d.number.toString())}," Take seat "+C(d.number+1),9,ht)):g("",!0)],12,yt))),128))])):g("",!0),l(B)?(x(),v("div",{key:2,id:"betRow",style:Y(Te())},[E("button",{disabled:!l(he),onClick:o[0]||(o[0]=d=>P(c.value-l(n).tableCard.thresholds.minimumBet))}," Reduce "+C(l(n).tableCard.thresholds.minimumBet),9,vt),E("button",{disabled:!l(xe),onClick:o[1]||(o[1]=d=>P(l(n).tableCard.thresholds.minimumBet))}," Minimum "+C(l(n).tableCard.thresholds.minimumBet),9,xt),E("button",{disabled:!l(Ce),onClick:o[2]||(o[2]=d=>P(I.value))}," Previous "+C(I.value),9,pt),E("button",{disabled:!l(ve),onClick:o[3]||(o[3]=d=>P(c.value+l(n).tableCard.thresholds.minimumBet))}," Add "+C(l(n).tableCard.thresholds.minimumBet),9,gt),E("button",{disabled:!l(pe),onClick:o[4]||(o[4]=d=>P(l(n).tableCard.thresholds.maximumBet))}," Max "+C(l(n).tableCard.thresholds.maximumBet),9,bt),E("button",{disabled:!l(Se),onClick:o[5]||(o[5]=d=>P(0))}," Remove bet ",8,Ct)],4)):g("",!0),l(n).gamePhase===l(k).INSURE?(x(),v("div",{key:3,id:"insureRow",style:G},[l(De)?(x(),v("button",{key:0,onClick:o[6]||(o[6]=d=>Ie())}," Insure ")):g("",!0)])):g("",!0),l(be)?(x(),v("div",St,[l(n).playerInTurn.actions.includes(l(b).TAKE)?(x(),v("button",{key:0,onClick:o[7]||(o[7]=d=>L(l(b).TAKE))},C(Ne()),1)):g("",!0),l(n).playerInTurn.actions.includes(l(b).SPLIT)?(x(),v("button",{key:1,onClick:o[8]||(o[8]=d=>L(l(b).SPLIT))}," Split ")):g("",!0),l(n).playerInTurn.actions.includes(l(b).DOUBLE_DOWN)?(x(),v("button",{key:2,onClick:o[9]||(o[9]=d=>L(l(b).DOUBLE_DOWN))}," Double down ")):g("",!0),l(n).playerInTurn.actions.includes(l(b).STAND)?(x(),v("button",{key:3,onClick:o[10]||(o[10]=d=>L(l(b).STAND))}," Stand ")):g("",!0)])):g("",!0)])}}});const Nt=ze(It,[["__scopeId","data-v-c88ba4cc"]]);export{Nt as default};
