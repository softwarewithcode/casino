import{d as he,h as L,i as me,c as f,b,o as g,s as re,j as Ge,k as p,g as ue,t as N,u as m,n as ce,l as T,e as pe,m as qe,v as Ke,F as Xe,p as Ye,q as Je,_ as Qe}from"./index-7eaccc1f.js";import{a as Z,j as V,P as E,b as de,G as Ze,r as q,i as et,S as tt,d as ot,e as B,k as y,l as K,m as st,g as at,h as nt}from"./websocket-93f296e7.js";import{u as it}from"./casinoStore-cbc67f66.js";import{l as ye,e as U,u as C,m as D,n as W,o as Y,d as lt,p as rt,k as ut,f as F,h as J,q as ct,r as pt,j as dt}from"./commonPainter-b21e1c8f.js";import{_ as ht}from"./TakeSeatButtonRow.vue_vue_type_script_setup_true_lang-ecd1858a.js";import{c as mt,a as yt,b as ft,d as gt,e as xt,f as Ct,u as A,g as I,h as j,i as vt,j as X}from"./chips-29ef6051.js";const ee=t=>{if(t===0)return{};let e=t;const s=Math.floor(e/1e4);s>=1&&(e-=s*1e4);const r=Math.floor(e/1e3);r>=1&&(e-=r*1e3);const i=Math.floor(e/100);i>=1&&(e-=i*100);const n=Math.floor(e/10);n>=1&&(e-=n*10);const l=Math.floor(e/5);l>=1&&(e-=l*5);const c=Math.floor(e/1);c>=1&&(e-=c);const u=new Map;return u.set(mt,s),u.set(yt,r),u.set(ft,i),u.set(gt,n),u.set(xt,l),u.set(Ct,c),{chips:u}};let x,v,H,Q,z,te,P,k,M;const At="Pot:";let G,fe,oe;function kt(t,e,s){Tt(s,e,t),s.getContext("2d")&&(Bt(s),!(!e||!e.userName)&&(bt(e,s,Z(t,e)),_t(s,e.seatNumber,t),Pt(s,t),wt(s,t)))}const Tt=(t,e,s)=>{te=s,x=t.height/4,v=t.width/4,Q=t.width/4,H=t.width,z={x:0,y:t.height*.75},P={x:t.width/25,y:t.height/25},t.width/20,s.seats.length-1,t.width/2,t.height/2,k={x:75,y:75},G={x:v*1.25,y:1.5*x},fe=A(G,v),M={x:k.x/2,y:k.y/2};const r=t.width/25;oe={x:r,y:r}};function ge(t,e){Y(t,X.image,{x:0,y:0},{x:X.image.width,y:X.image.height},e,oe)}const bt=(t,e,s)=>{var c;if(!e.getContext("2d"))return;const i=V(t,E.ACTIVE)?void 0:ye;U(e,{x:0,y:e.height*.75},{x:e.width,y:e.height},s,i),C(e,{x:5,y:3*x+18},t.userName,F),C(e,{x:5,y:3*x+35},"total "+t.currentBalance,J);const n={x:0,y:e.height*.75},l={x:e.width/3,y:n.y+10};if(t.cards&&t.cards.length>=2?(D(e,t.cards[0],l,k),D(e,t.cards[1],A(l,95),k)):t.cards&&t.cards.length===0&&(W(e,l,M),W(e,A(l,50),M)),t.chipsOnTable>0){const u=ee(t.chipsOnTable),w=I(z,H/3,-P.y-10),O=A(w,250);C(e,j(w,-10),t.chipsOnTable.toFixed(2),J),se(e,w,O,u)}if(((c=te.button)==null?void 0:c.seatNumber)===t.seatNumber){const u=I(z,H*.75,-25);ge(e,u)}if(t.lastAction){const u=z,w={x:H,y:Q},O=I(u,H/3,Q/2);xe(e,u,w,O,t)}},xe=(t,e,s,r,i)=>{i.lastAction&&(U(t,e,s,!1,ct),C(t,r,i.lastAction,pt))},St=(t,e,s,r)=>{var n;if(U(t,e,{x:v,y:x},r),!s.player){C(t,{x:e.x+10,y:e.y+50},"Seat "+s.number,F);return}V(s.player,E.ACTIVE)||U(t,e,{x:v,y:x},r,ye),C(t,{x:e.x+5,y:e.y+18},s.player.userName,F),C(t,{x:e.x+5,y:e.y+35},"$"+s.player.currentBalance,F);const i=I(e,50,50);if(s.player.cards&&s.player.cards.length>=2?(D(t,s.player.cards[0],i,k),D(t,s.player.cards[1],A(i,k.x),k)):s.player.cards&&s.player.cards.length===0&&(W(t,i,M),W(t,A(i,50),M)),C(t,{x:e.x+5,y:e.y+35},"$"+s.player.currentBalance,F),s.player.chipsOnTable>0){const l=ee(s.player.chipsOnTable),c=j(e,x-P.y);C(t,j(c,-10),s.player.chipsOnTable.toFixed(2),J);const u=I(e,v,x-20);se(t,c,u,l)}if(((n=te.button)==null?void 0:n.seatNumber)===s.number){const l=I(e,v-oe.x,0);ge(t,l)}if(s.player.lastAction){const l=e,c={x:v,y:x},u=I(l,20,x/2);xe(t,l,c,u,s.player)}},se=(t,e,s,r)=>{let i=0;for(let[n,l]of r.chips.entries())if(!(l<1))for(let c=0;c<l;c++){const u=A(e,P.x*i);u.x>A(s,-P.x).x?Y(t,vt.image,{x:0,y:0},{x:n.image.width,y:n.image.height},A(s,-P.x),P):Y(t,n.image,{x:0,y:0},{x:n.image.width,y:n.image.height},u,P),i++}},_t=(t,e,s)=>{if(!t.getContext("2d"))return;let i=de(e,s);for(let n=0;n<s.seats.length;n++){const l=s.seats.find(c=>c.number===i);if(e!==l.number){const c=lt(n,v,x,s.seats.length-1);St(t,c,l,Z(s,l.player))}i=de(i,s)}};function Bt(t){rt(t,ut,{x:0,y:0},{x:t.width,y:t.height})}function Pt(t,e){if(e.pots)for(const s of e.pots){const r=At+s.amountWithTableChips.toFixed(2);if(e.gamePhase!==Ze.PRE_FLOP){const i=ee(s.amountWithTableChips);se(t,G,fe,i)}C(t,j(G,-20),r,F)}}function wt(t,e){if(!e.tableCards||e.tableCards.length===0)return;const s={x:v*1.15,y:t.height/2};for(let r=0;r<e.tableCards.length;r++)D(t,e.tableCards[r],A(s,r*k.x),k)}const It={style:{padding:"5px"}},Nt=["min","max","value","step"],Et=he({__name:"RangeView",props:{range:{},step:{}},emits:[q],setup(t,{emit:e}){const s=t,r=e,i=L(s.range.min);me(()=>{r(q,s.range.min)});const n=l=>{i.value=l.target.value,r(q,i.value)};return(l,c)=>(g(),f("span",It,[b("input",{type:"range",onInput:n,min:l.range.min,max:l.range.max,value:i.value,step:l.step,id:"range"},null,40,Nt)]))}}),Ft=t=>(Ye("data-v-55431552"),t=t(),Je(),t),Ot={style:{position:"relative"}},Rt=Ft(()=>b("canvas",{id:"canvas",width:"800",height:"600"},null,-1)),Lt={key:1,id:"takeSeatRow"},Ht={key:0,style:{position:"relative",top:"-55px",float:"left"}},Vt={style:{position:"relative",top:"-55px"}},Dt={key:3,style:{border:"1px solid black",padding:"10px"}},Mt=he({__name:"TexasHoldemTableView",props:{tableId:{}},setup(t){const e=et(),s=it(),r=L(!1),{table:i,mainPlayer:n,lastActor:l,command:c}=re(e),{counter:u}=re(s),w=e.$subscribe((o,a)=>{o.type==="patch object"&&O()}),O=()=>{if(Ce()){Ae();const o=l.value;setTimeout(ke,2100,o)}R(),c.value===tt.ROUND_COMPLETED&&setTimeout(ve,2500)},Ce=()=>{var o;return(o=l.value)==null?void 0:o.lastAction},ve=()=>{e.clearTableAndPlayers(),R()},Ae=()=>{var a;const o=(a=i.value.seats.find(d=>d.player&&d.player.userName===l.value.userName))==null?void 0:a.player;o&&(o.lastAction=l.value.lastAction)};me(()=>{r.value=!0,R()}),Ge(()=>{w(),nt()});const ke=o=>{be(o),R()},R=async()=>{const o=Te(),a=ot(i.value,n.value);kt(i.value,a,o)},Te=()=>{const o=dt(document.getElementById("canvas"));if(!o.getContext("2d"))throw new Error("no canvas");return o},be=o=>{e.resetLastActionFromPlayer(o.userName)},ae=p(()=>{var o;return((o=n.value)==null?void 0:o.seatNumber)>=0}),Se=p(()=>i.value.tableCard.availablePositions.length>0&&!ae.value),_e=p(()=>{var o;return(o=n.value.actions)==null?void 0:o.flatMap(a=>a.type).includes(y.CHECK)}),Be=p(()=>{var o;return(o=n.value.actions)==null?void 0:o.flatMap(a=>a.type).includes(y.BET_RAISE)}),Pe=p(()=>{var o;return(o=n.value.actions)==null?void 0:o.flatMap(a=>a.type).includes(y.CALL)}),we=p(()=>{var o;return(o=n.value.actions)==null?void 0:o.flatMap(a=>a.type).includes(y.FOLD)}),Ie=p(()=>{var o;return(o=n.value.actions)==null?void 0:o.flatMap(a=>a.type).includes(y.ALL_IN)}),Ne=p(()=>{var o,a;return((a=(o=n.value)==null?void 0:o.actions)==null?void 0:a.length)>0&&Z(i.value,n.value)&&V(n.value,E.ACTIVE)}),Ee=p(()=>n.value.currentBalance<=i.value.tableCard.gameData.bigBlind+i.value.tableCard.gameData.smallBlind&&!ie.value),Fe=p(()=>at(i.value)),h=p(()=>{var o,a;return(a=(o=n.value.actions)==null?void 0:o.find(d=>d.type===y.BET_RAISE))==null?void 0:a.range}),Oe=p(()=>i.value.seats.filter(o=>o.player).map(o=>o.player).some(o=>o.chipsOnTable>0)?"RaiseTo":"Bet"),Re=p(()=>({left:"200px",top:"350px",color:"yellow","font-size":"22px","z-index":10})),Le=p(()=>{const o={"background-color":"green","font-size":"120%"};return(V(n.value,E.SIT_OUT)||$.value)&&(o["background-color"]="red"),o}),He=p(()=>h.value?h.value.max*.001:0),Ve=()=>n.value.currentBalance+n.value.chipsOnTable,S=L(h.value===void 0?0:h.value.min),De=o=>S.value=parseFloat(o),ne=o=>{!S.value||!h.value||(S.value=o(S.value,He.value,h.value),S.value=Number(S.value.toFixed(2)))},Me=(o,a,d)=>o-a>=d.min?o-a:d.min,$e=(o,a,d)=>o+a<=d.max?o+a:d.max,ze=o=>B({action:y.BET_RAISE,amount:o}),$=L(!1),Ue=()=>{!$.value&&V(n.value,[E.NEW,E.ACTIVE])?(B({action:K.SIT_OUT_NEXT_HAND}),$.value=!0):($.value=!1,B({action:K.CONTINUE_GAME}))},We=()=>{B({action:y.FOLD}),n.value.cards=[],R()},ie=L(!1),je=()=>{B({action:K.RELOAD_CHIPS}),ie.value=!0};return(o,a)=>{var d,le;return g(),f(Xe,null,[ue(" Texas holdem table "),b("div",Ot,[ue(" Welcome "+N((d=m(n))==null?void 0:d.userName)+" ",1),m(st)()&&m(u)>0?(g(),f("div",{key:0,style:ce([{position:"absolute"},Re.value])},N(m(u)),5)):T("",!0),Rt,Se.value?(g(),f("div",Lt,[pe(ht,{seats:Fe.value},null,8,["seats"])])):T("",!0),b("div",null,[ae.value?(g(),f("span",Ht,[b("button",{onClick:a[0]||(a[0]=_=>Ue()),id:"sitOut",name:"sitOut",style:ce(Le.value)}," 🕐 ",4)])):T("",!0),qe(b("div",Vt,[we.value?(g(),f("button",{key:0,onClick:a[1]||(a[1]=_=>We())}," Fold ")):T("",!0),_e.value?(g(),f("button",{key:1,onClick:a[2]||(a[2]=_=>m(B)({action:m(y).CHECK}))}," Check ")):T("",!0),Pe.value?(g(),f("button",{key:2,onClick:a[3]||(a[3]=_=>m(B)({action:m(y).CALL}))}," Call "+N(m(e).callAmount),1)):T("",!0),Be.value&&((le=h.value)!=null&&le.min)?(g(),f("span",Dt,[pe(Et,{range:h.value,step:h.value.max*.01,min:h.value.min,max:h.value.max,onRangeInputUpdate:De},null,8,["range","step","min","max"]),b("button",{onClick:a[4]||(a[4]=_=>ne(Me))}," -"),b("button",{onClick:a[5]||(a[5]=_=>ze(S.value))},N(Oe.value)+" "+N(S.value),1),b("button",{onClick:a[6]||(a[6]=_=>ne($e))}," +")])):T("",!0),Ie.value?(g(),f("button",{key:4,onClick:a[7]||(a[7]=_=>m(B)({action:m(y).ALL_IN})),style:{position:"relative",float:"right"}}," All in "+N(Ve()),1)):T("",!0)],512),[[Ke,Ne.value]]),Ee.value?(g(),f("button",{key:1,onClick:a[8]||(a[8]=_=>je()),style:{position:"relative",float:"right",top:"-55px"}}," Reload ")):T("",!0)])])],64)}}});const qt=Qe(Mt,[["__scopeId","data-v-55431552"]]);export{qt as default};
