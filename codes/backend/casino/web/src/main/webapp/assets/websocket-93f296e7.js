import{B as A,C as m,V as I}from"./index-7eaccc1f.js";import{a as S,u as _}from"./casinoStore-cbc67f66.js";const f="BLACKJACK",M="TEXAS_HOLDEM",U="ROULETTE";var y=(e=>(e.MULTIPLAYER="MULTIPLAYER",e.SINGLEPLAYER="SINGLEPLAYER",e))(y||{}),N=(e=>(e.BLACKJACK="blackjack",e.TEXAS_HOLDEM="texas-holdem",e.ROULETTE="roulette",e))(N||{}),B=(e=>(e.SIT_OUT="SIT_OUT",e.ACTIVE="ACTIVE",e.NEW="NEW",e))(B||{});const Ae="rangeInputUpdate",g=A("blackjackStore",{state:()=>({tables:[],table:{},command:{},player:{}}),getters:{getTables(e){return e.tables},getTable(e){return e.table},getPlayer(e){return e.player}},actions:{async populateStore(){try{let e=await S(N.BLACKJACK);this.tables=e.sort((t,r)=>t.thresholds.minimumBet-r.thresholds.minimumBet)}catch(e){alert(e)}},logout(e){this.player=e}}});var a=(e=>(e.NEW_PLAYER="NEW_PLAYER",e.BET_TIME_START="BET_TIME_START",e.INSURANCE_TIME_START="INSURANCE_TIME_START",e.PLAYER_TIME_START="PLAYER_TIME_START",e.LOGIN="LOGIN",e.ROUND_COMPLETED="ROUND_COMPLETED",e.PLAYER_LEFT="PLAYER_LEFT",e.STATUS_UPDATE="STATUS_UPDATE",e.OPEN_TABLE="OPEN_TABLE",e.TIMED_OUT="TIMED_OUT",e.INITIAL_DEAL_DONE="INITIAL_DEAL_DONE",e.NO_BETS_NO_DEAL="NO_BETS_NO_DEAL",e.SHOWDOWN="SHOWDOWN",e.INIT_DATA="INIT_DATA",e.SPINNING="SPINNING",e))(a||{});let T=-1,O;function L(){O=_(),k()}function Ie(){return T!==-1}function u(){T&&(clearInterval(T),T=-1)}function k(){u(),T=setInterval(()=>{O.reduceCounter(),O.getCounter<=0&&u()},1e3)}const Se=(e,t)=>{if(e===t.seats.length-1)return 0;let r=e;return r++,r++},Re=(e,t)=>H(t,e.activePlayer),Pe=(e,t)=>e?t&&t.length>0?t.includes(e.status):t===e.status:!1,H=(e,t)=>!e||!t?!1:e.userName===t.userName,Ce=e=>D({action:"JOIN",seat:e.toString()}),he=()=>D({action:"JOIN"}),R=async(e,t)=>await m.push({name:t,params:{tableId:e.id}}),De=(e,t)=>{var r;return t!=null&&t.userName?t:(r=e.seats.find(s=>{var o;return(o=s==null?void 0:s.player)==null?void 0:o.userName}))==null?void 0:r.player},d=(e,t)=>t?e.seats.filter(s=>s.player!=null).map(s=>s.player).filter(s=>s.userName===t.userName).length>0:!1,F=e=>e.seats.some(t=>t.available),ye=(e,t)=>!d(e,t)&&F(e)&&$(e,t),$=(e,t)=>t.initialBalance>=e.tableCard.gameData.minBuyIn,v=(e,t)=>e.seats.filter(r=>r.player!=null).map(r=>r.player).filter(r=>r.userName===(t==null?void 0:t.userName))[0],pe=e=>e.seats.filter(t=>t).sort((t,r)=>t.number-r.number),me=e=>(e==null?void 0:e.seatNumber)>=0,fe=()=>document.getElementById("canvas"),c=g(),K=_();function w(e){switch(c.$patch({command:e.title}),c.getPlayer&&(e.table.players.find(r=>r.userName===c.getPlayer.userName)||c.logout({})),e.title){case a.OPEN_TABLE:J(e);break;case a.LOGIN:c.$patch({player:e.player});break;case a.NO_BETS_NO_DEAL:Y(e);break;case a.BET_TIME_START:case a.PLAYER_TIME_START:case a.INSURANCE_TIME_START:case a.INITIAL_DEAL_DONE:p(e);break;case a.ROUND_COMPLETED:W(e);break;default:P(e)}}const J=e=>{let t=e.table;R(t,I.BLACKJACK_TABLE),p(e)},Y=e=>{let t={table:e.table,player:e.player,command:e.title};c.$patch(t)},P=e=>{let t={table:e.table,command:e.title};const r=e.table.players.find(s=>{var o;return s.userName===((o=c.getPlayer)==null?void 0:o.userName)});c.getPlayer&&r&&(t.player=r),V(e.table.counterTime),c.$patch(t)},V=e=>{let t={counter:e};K.$patch(t)},p=e=>{P(e),L()},W=e=>{const t=e.table.tableCard.gameData.roundDelay;e.table.counterTime=t/1e3,P(e),L()};var n=(e=>(e.ALL_IN="ALL_IN",e.CHECK="CHECK",e.FOLD="FOLD",e.BET_RAISE="BET_RAISE",e.CALL="CALL",e))(n||{}),j=(e=>(e.RELOAD_CHIPS="RELOAD_CHIPS",e.SIT_OUT_NEXT_HAND="SIT_OUT_NEXT_HAND",e.CONTINUE_GAME="CONTINUE_GAME",e))(j||{}),x=(e=>(e.PRE_FLOP="PRE_FLOP",e.FLOP="FLOP",e.TURN="TURN",e.RIVER="RIVER",e.ROUND_COMPLETED="ROUND_COMPLETED",e))(x||{});const X=A("texasHoldemStore",{state:()=>({tables:[],table:{},command:{},mainPlayer:{},lastActor:{},holeCards:[]}),getters:{tableCards(e){return e.tables},callAmount(e){var t;return(t=e.mainPlayer.actions)==null?void 0:t.find(r=>r.type===n.CALL).range.max},hasMainPlayerHoleCards(e){return e.mainPlayer.cards&&e.mainPlayer.cards.length>=2}},actions:{async populateStore(){try{let e=await S(N.TEXAS_HOLDEM);this.tables=e}catch(e){alert(e)}},resetLastActionFromPlayer(e){var r;if(this.mainPlayer&&this.mainPlayer.userName===e){this.mainPlayer.lastAction=void 0;return}let t=(r=this.table.seats.find(s=>s.player&&s.player.userName===e))==null?void 0:r.player;t&&(t.lastAction=void 0)},clearTableAndPlayers(){u(),this.table.seats.filter(e=>e.player).map(e=>e.player).forEach(e=>{e.actions=[],e.lastAction=void 0,e.cards=void 0,e.chipsOnTable=0}),this.table.pots=[],this.mainPlayer.actions=[],this.mainPlayer.cards=void 0,this.mainPlayer.chipsOnTable=0},logout(){this.mainPlayer={}}}}),l=X(),G=_();function Z(e){switch(l.$patch({command:e.title}),l.mainPlayer&&(e.table.players.find(r=>{var s;return r.userName===((s=l.mainPlayer)==null?void 0:s.userName)})||l.logout()),e.title){case a.OPEN_TABLE:z(e);break;case a.LOGIN:l.$patch({mainPlayer:e.player});break;case a.NO_BETS_NO_DEAL:l.clearTableAndPlayers();break;case a.ROUND_COMPLETED:te(e);break;default:ee(e)}}const z=async e=>{let t=e.table;R(t,I.TEXAS_HOLDEM_TABLE),C(e)},C=async e=>{let t={table:e.table,command:e.title};se(e,t),ae(e,t),Q(e.table.counterTime),l.$patch(t)},q=e=>{if(e.title===n.ALL_IN.toString())return n.ALL_IN;if(e.title===n.BET_RAISE.toString())return n.BET_RAISE;if(e.title===n.CALL.toString())return n.CALL;if(e.title===n.FOLD.toString())return n.FOLD;if(e.title===n.CHECK.toString())return n.CHECK},Q=async e=>{let t={counter:e};G.$patch(t)},ee=async e=>{C(e),L()},te=async e=>{u(),C(e)},re=e=>e.cards;function se(e,t){const r=e.table.players.find(s=>{var o;return s.userName===((o=l.mainPlayer)==null?void 0:o.userName)});l.mainPlayer&&r&&(t.mainPlayer=r,re(e)?t.mainPlayer.cards=e.cards:l.hasMainPlayerHoleCards?t.mainPlayer.cards=l.mainPlayer.cards:t.mainPlayer.cards=void 0)}function ae(e,t){const r=q(e);if(r){const s=e.table.players.find(o=>o.userName===e.player.userName);t.lastActor=s,t.lastActor.lastAction=r}}var b=(e=>(e.SINGLE_NUMBER="SINGLE_NUMBER",e.DOUBLE_NUMBER="DOUBLE_NUMBER",e.TRIPLE_NUMBER="TRIPLE_NUMBER",e.QUADRUPLE_NUMBER="QUADRUPLE_NUMBER",e.SIX_NUMBER="SIX_NUMBER",e.RED="RED",e.BLACK="BLACK",e.FIRST_DOZEN="FIRST_DOZEN",e.SECOND_DOZEN="SECOND_DOZEN",e.THIRD_DOZEN="THIRD_DOZEN",e.LOW_NUMBERS="LOW_NUMBERS",e.HIGH_NUMBERS="HIGH_NUMBERS",e.FIRST_COLUMN="FIRST_COLUMN",e.SECOND_COLUMN="SECOND_COLUMN",e.THIRD_COLUMN="THIRD_COLUMN",e.EVEN="EVEN",e.ODD="ODD",e.FIRST_HALF="FIRST_HALF",e.SECOND_HALF="SECOND_HALF",e))(b||{}),ne=(e=>(e.REMOVE_BET_FROM_POSITION="REMOVE_BET_FROM_POSITION",e.REMOVE_LAST_OR_ALL="REMOVE_LAST_OR_ALL_BETS",e.BET="BET",e.PLAY="PLAY",e.REPEAT_LAST="REPEAT_LAST",e.FETCH_BET_POSITIONS="FETCH_BET_POSITIONS",e))(ne||{}),le=(e=>(e.BET="BET",e.ROUND_COMPLETED="ROUND_COMPLETED",e.SPINNING="SPINNING",e))(le||{});const oe=A("rouletteStore",{state:()=>({tables:[],table:{},betPositions:[],redNumbers:[],blackNumbers:[],serverCommand:{},mainCharacter:{}}),getters:{getTableCards(e){return e.tables},getTable(e){return e.table},getMainCharacter(e){return e.mainCharacter},getTableBetPositions(e){return e.betPositions},getBlackNumbers:e=>e.blackNumbers,getRedNumbers:e=>e.redNumbers,getReversedResultBoard:e=>e.table.wheel.resultBoard.slice().reverse()},actions:{async populateStore(){try{let e=await S(N.ROULETTE);this.tables=e.sort((t,r)=>t.thresholds.minimumBet-r.thresholds.minimumBet)}catch(e){alert(e)}},logout(e){this.mainCharacter=e}}}),E=oe(),ce=_();function ie(e){switch(e.title){case a.OPEN_TABLE:let t={table:e.table,serverCommand:e.title,mainCharacter:e.player};E.$patch(t),Ee(e);break;case a.LOGIN:E.$patch({serverCommand:e.title,mainCharacter:e.player,table:e.table});break;case a.BET_TIME_START:Te(e);break;case a.ROUND_COMPLETED:ue(e);break;case a.INIT_DATA:const r={serverCommand:e.title,betPositions:e.tableBetPositions,blackNumbers:e.tableBetPositions.find(s=>s.type.name===b.BLACK).tableNumbers,redNumbers:e.tableBetPositions.find(s=>s.type.name===b.RED).tableNumbers};E.$patch(r);break;default:h(e)}}const Ee=e=>{let t=e.table;R(t,I.ROULETTE_TABLE)},h=e=>{let t={table:e.table,serverCommand:e.title};if(E.mainCharacter){const r=v(e.table,E.getMainCharacter);r&&(E.mainCharacter.positionsTotalAmounts=[],t.mainCharacter=r)}E.$patch(t)},Te=e=>{if(h(e),e.table.type===y.MULTIPLAYER){const t={serverCommand:e.title,counter:e.table.counterTime};ce.$patch(t),L()}},ue=e=>{u(),h(e)};let i;const _e="ws://localhost:8080/casino",Ne='{ "action": "OPEN_TABLE"}';async function Me(e,t){const r=_e+`/${e}/${t}`;await Le(r.toLocaleLowerCase())}const D=e=>i.send(JSON.stringify(e)),Ue=()=>i==null?void 0:i.close();function Le(e){i=new WebSocket(e),i.onopen=r=>D(JSON.parse(Ne)),i.onmessage=r=>{let s=JSON.parse(r.data);switch(s.game){case f:w(s);break;case M:Z(s);break;case U:ie(s);break;default:throw new Error("no handler for data "+JSON.stringify(s))}},i.onerror=r=>{console.error("socket error"+JSON.stringify(r)),t()},i.onclose=r=>{t()};const t=()=>{}}export{x as G,B as P,le as R,a as S,y as T,Re as a,Se as b,fe as c,De as d,D as e,me as f,pe as g,Ue as h,X as i,Pe as j,n as k,j as l,Ie as m,Ce as n,oe as o,Me as p,ne as q,Ae as r,d as s,ye as t,g as u,he as v};
