import{d as Ne,h as W,s as ae,i as ke,j as _e,k as m,c as p,g as Ie,t as S,u as d,n as ne,l as P,e as we,b as B,m as Ae,v as Re,o as C,p as Le,q as Oe,_ as Ue}from"./index-7eaccc1f.js";import{a as F,b as se,u as We,c as L,S as j,d as He,e as V,f as Me,T as $e,g as ze,h as je}from"./websocket-93f296e7.js";import{u as D,a as Ve,b as Ye,c as Fe,d as K,e as X,f as k,g as Y,h as re,i as Ke,j as Xe,k as qe}from"./commonPainter-b21e1c8f.js";import{_ as Je}from"./TakeSeatButtonRow.vue_vue_type_script_setup_true_lang-ecd1858a.js";import{u as Qe}from"./casinoStore-cbc67f66.js";var f=(e=>(e.TAKE="TAKE",e.DOUBLE_DOWN="DOUBLE_DOWN",e.STAND="STAND",e.SPLIT="SPLIT",e.INSURE="INSURE",e.BET="BET",e))(f||{}),E=(e=>(e.INSURE="INSURE",e.BET="BET",e.ROUND_COMPLETED="ROUND_COMPLETED",e))(E||{});const M="-",le=1500;let c,x,N,q;const O=6;function Ze(e,t,a){J(a,t,e),a.getContext("2d")&&(!t||Object.keys(t).length===0||(it(t,a,F(e,t)),rt(t.seatNumber,e,a),lt(e,a)))}function Ge(e,t,a){J(a,t,e);const s=ie(e);s.length!==0&&(tt(s,t,a),et(e,a),ue(s,t,a))}const et=(e,t)=>{e.dealerHand.cards.forEach((a,s)=>{Q(M,a,s,0,t)})},tt=(e,t,a)=>{e.forEach(s=>{s.hands.forEach((n,u)=>{n.cards.forEach((r,i)=>{Q(s.userName,r,i,u,a)})})})};async function at(e,t,a){if(!a.getContext("2d"))return;J(a,t,e);const n=ie(e);oe(n,a);const u=e.dealerHand.cards[0];await de(le,M,u,0,0,a),oe(n,a),ue(n,t,a)}const ie=e=>e.seats.map(t=>t.player).filter(t=>{var a;return(t==null?void 0:t.hands)&&((a=t.hands[0])==null?void 0:a.cards.length)>0}),oe=async(e,t)=>{for(let a=0;a<e.length;a++){const s=e[a],n=s.hands[0].cards.findIndex(i=>!i.hasOwnProperty("visible")),u=s.hands[0].cards[n],r=0;await de(le,s.userName,u,n,r,t),u.visible=!0}},ue=(e,t,a)=>{for(const s of e){const n=ve(s.userName),u=K(n,x,c,O);ce(s.userName);const r=s.userName===t.userName?w.y:I.y;nt(s).forEach((i,y)=>{const v=u.y+r/2+r*y;i.values.length===1?D(a,{x:u.x+x-50,y:v},i.values[0].toString(),k):D(a,{x:u.x+x-50,y:v},i.values[0].toString()+"/"+i.values[1].toString(),k)})}},nt=e=>e?e.hands:[],J=(e,t,a)=>{N=t,q=a,c=e.height/4,x=e.width/4},de=async(e,t,a,s,n,u)=>{await Ve(e),Q(t,a,s,n,u)},Q=(e,t,a,s,n)=>{const u=n.getContext("2d");if(!t||!u){console.error("cannot draw");return}const r=Ye(t),i=ce(e),y=st(e,a,s);u.drawImage(Fe,r.position.x,r.position.y,r.size.x,r.size.y,y.x,y.y,i.x,i.y)};let H,I,w;const st=(e,t,a)=>{if(e===M){const i=x+t*H.x+20,y=c+c;return{x:i,y}}if(e===N.userName){const i=x+t*w.x+20,y=3*c+a*w.y;return{x:i,y}}const s=ve(e);let n=K(s,x,c,O),u=n.x+I.x*t+2,r=n.y+n.y/3+a*I.y;return{x:u,y:r}},ce=e=>{if(e===M){if(!H){const a=c*.65;H={x:a*Y,y:a}}return H}const t=ot(e);if(e===N.userName){if(!w){const a=t>0?c/2:c;w={x:a*Y,y:a}}return w}if(!I){const a=t>0?c/2.5:c/1.5;I={x:a*Y,y:a}}return I},ot=e=>{var a;const t=(a=q.seats.find(s=>{var n;return((n=s.player)==null?void 0:n.userName)===e}))==null?void 0:a.player.hands.length;if(!t)throw new Error("no hand count");return t},rt=(e,t,a)=>{if(!a.getContext("2d"))return;let n=se(e,t);for(let u=0;u<t.seats.length;u++){const r=t.seats.find(i=>i.number===n);e!==r.number&&ut(K(u,x,c,O),r,a,F(t,r.player)),n=se(n,t)}},ve=e=>{if(N.userName===e)return O;const t=q.seats.find(a=>{var s;return((s=a.player)==null?void 0:s.userName)===e});if(!t)throw new Error("player not found "+e);return N.seatNumber>t.number?O-(N.seatNumber-t.number):t.number-N.seatNumber-1},lt=(e,t)=>{if(!t.getContext("2d"))return;X(t,{x,y:c},{x:2*x,y:2*c},!1);const s="Dealer"+(e.dealerHand.values[0]>0?" has "+e.dealerHand.values[0].toString():"");D(t,{x:x+10,y:c+20},s,re)},it=(e,t,a)=>{if(!t.getContext("2d"))return;X(t,{x:0,y:t.height*.75},{x:t.width,y:t.height},a),D(t,{x:5,y:3*c+18},e.userName,k),D(t,{x:5,y:3*c+35},"total "+e.currentBalance,re);const n=e.totalBet!=null?e.totalBet:0;D(t,{x:5,y:3*c+55},"bet "+n,k)},ut=(e,t,a,s)=>{if(X(a,e,{x,y:c},s),!t.player){D(a,{x:e.x+10,y:e.y+50},"Seat "+t.number,k);return}D(a,{x:e.x+5,y:e.y+18},t.player.userName,k),D(a,{x:e.x+5,y:e.y+35},"$"+t.player.currentBalance,k)},dt=e=>(Le("data-v-a64c8843"),e=e(),Oe(),e),ct={style:{position:"relative"}},vt=dt(()=>B("canvas",{id:"canvas",width:"1800",height:"600"},null,-1)),mt={key:1,id:"takeSeatRow"},xt=["disabled"],ft=["disabled"],yt=["disabled"],gt=["disabled"],ht=["disabled"],bt=["disabled"],pt={key:3,id:"insureRow",style:{position:"absolute"}},Ct=["disabled"],Bt={id:"actionRow",style:{position:"absolute",bottom:"25px: left:50px"}},Dt=Ne({__name:"BlackjackTableView",props:{tableId:{}},setup(e){const t=W(!1),a=We(),s=Qe(),{table:n,command:u,player:r}=ae(a),{counter:i}=ae(s),y=a.$subscribe((l,o)=>{l.type==="patch object"&&me()}),v=W(0),A=W(0);ke(()=>{t.value=!0,Ke(L()),z(!1)}),_e(()=>{y(),console.log("Closing:"),je(),a.$reset()});const me=()=>{var o;if(z(n.value.gamePhase==="PLAY"&&u.value===j.INITIAL_DEAL_DONE),n.value.gamePhase!==E.ROUND_COMPLETED)return;v.value=0;const l=(o=n.value.seats.find(h=>{var b,R;return((b=h.player)==null?void 0:b.userName)===((R=r.value)==null?void 0:R.userName)}))==null?void 0:o.player;l&&(A.value=l.totalBet>n.value.tableCard.gameData.maxBet?n.value.tableCard.gameData.maxBet:l.totalBet)},Z=m(()=>{var l;return i.value<=0||!t.value?"":n.value.gamePhase===E.ROUND_COMPLETED?"Next round starts in "+i.value:n.value.gamePhase===E.INSURE?"Insurance time left "+i.value:u.value===j.PLAYER_TIME_START||u.value===j.INITIAL_DEAL_DONE?"Player "+((l=n.value.activePlayer)==null?void 0:l.userName)+" "+i.value:T.value?"Place your bets "+i.value:n.value.gamePhase===E.BET?"Bet phase "+i.value:""}),_=l=>{v.value=l,V({action:f.BET,amount:l}),r.value.totalBet=v.value,z(!1)},$=m(()=>Me(r.value)),xe=m(()=>T.value&&v.value-n.value.tableCard.gameData.minBet>=0),fe=m(()=>{var l;return T.value&&v.value>=0&&v.value+n.value.tableCard.gameData.minBet<=n.value.tableCard.gameData.maxBet&&((l=r.value)==null?void 0:l.currentBalance)-(v.value+n.value.tableCard.gameData.minBet)>=0}),ye=m(()=>{var l;return T.value&&((l=r.value)==null?void 0:l.currentBalance)>=n.value.tableCard.gameData.minBet&&v.value!==n.value.tableCard.gameData.minBet}),ge=m(()=>{var l;return T.value&&((l=r.value)==null?void 0:l.currentBalance)>n.value.tableCard.gameData.maxBet}),T=m(()=>n.value.gamePhase===E.BET&&$.value&&i.value>0),he=m(()=>{const l=n.value.tableCard;return l.type===$e.MULTIPLAYER?!$.value&&n.value.seats.map(o=>o.available)!=null:l.availablePositions.length>=l.thresholds.seatCount}),be=m(()=>n.value.gamePhase==="PLAY"&&F(n.value,r.value)),pe=m(()=>T.value&&A.value>0&&(r==null?void 0:r.value.currentBalance)>=A.value),Ce=m(()=>v.value>0),Be=()=>{G.value=!0,V({action:f.INSURE})},U=l=>V({action:l}),De=m(()=>ze(n.value)),z=async l=>{const o=Xe(L()),h=o.getContext("2d");if(!h)return;h.drawImage(qe,0,0,o.width,o.height);const b=He(n.value,r.value);Ze(n.value,b,o),l?at(n.value,b,o):Ge(n.value,b,o)},Se=()=>({display:"inline",bottom:L().height/8+"px","margin-right":"45px",left:"55px"}),Pe=m(()=>{const l=(L().height*.72).toString()+"px",o=(L().width/3).toString()+"px",h=i.value>4?"yellow":"red";return{left:o,top:l,color:h,"font-size":"22px","z-index":10}}),Ee=()=>r.value.hands?r.value.hands.length===1?"Take":r.value.hands[0].active?"Take ( first )":"Take ( second )":"",G=W(!1),Te=m(()=>$.value&&n.value.gamePhase===E.INSURE&&r.value.currentBalance>=r.value.totalBet/2&&G.value===!1&&r.value.hands[0].cards.length>0);return(l,o)=>{var h,b,R,ee,te;return C(),p("div",ct,[Ie(" Welcome "+S((h=d(r))==null?void 0:h.userName)+" ",1),Z.value?(C(),p("div",{key:0,style:ne([{position:"absolute"},Pe.value])},S(Z.value),5)):P("",!0),vt,he.value?(C(),p("div",mt,[we(Je,{seats:De.value},null,8,["seats"])])):P("",!0),T.value?(C(),p("div",{key:2,id:"betRow",style:ne([{position:"absolute"},Se()])},[B("button",{disabled:!xe.value,onClick:o[0]||(o[0]=g=>_(v.value-d(n).tableCard.gameData.minBet))}," Reduce "+S(d(n).tableCard.gameData.minBet),9,xt),B("button",{disabled:!ye.value,onClick:o[1]||(o[1]=g=>_(d(n).tableCard.gameData.minBet))}," Minimum "+S(d(n).tableCard.gameData.minBet),9,ft),B("button",{disabled:!pe.value,onClick:o[2]||(o[2]=g=>_(A.value))}," Previous "+S(A.value),9,yt),B("button",{disabled:!fe.value,onClick:o[3]||(o[3]=g=>_(v.value+d(n).tableCard.gameData.minBet))}," Add "+S(d(n).tableCard.gameData.minBet),9,gt),B("button",{disabled:!ge.value,onClick:o[4]||(o[4]=g=>_(d(n).tableCard.gameData.maxBet))}," Max "+S(d(n).tableCard.gameData.maxBet),9,ht),B("button",{disabled:!Ce.value,onClick:o[5]||(o[5]=g=>_(0))}," Remove bet ",8,bt)],4)):P("",!0),d(n).gamePhase===d(E).INSURE?(C(),p("div",pt,[B("button",{disabled:!Te.value,onClick:o[6]||(o[6]=g=>Be())}," Insure ",8,Ct)])):P("",!0),Ae(B("div",Bt,[(b=d(n).activePlayer)!=null&&b.actions.includes(d(f).TAKE)?(C(),p("button",{key:0,onClick:o[7]||(o[7]=g=>U(d(f).TAKE))},S(Ee()),1)):P("",!0),(R=d(n).activePlayer)!=null&&R.actions.includes(d(f).SPLIT)?(C(),p("button",{key:1,onClick:o[8]||(o[8]=g=>U(d(f).SPLIT))}," Split ")):P("",!0),(ee=d(n).activePlayer)!=null&&ee.actions.includes(d(f).DOUBLE_DOWN)?(C(),p("button",{key:2,onClick:o[9]||(o[9]=g=>U(d(f).DOUBLE_DOWN))}," Double down ")):P("",!0),(te=d(n).activePlayer)!=null&&te.actions.includes(d(f).STAND)?(C(),p("button",{key:3,onClick:o[10]||(o[10]=g=>U(d(f).STAND))}," Stand ")):P("",!0)],512),[[Re,be.value]])])}}});const kt=Ue(Dt,[["__scopeId","data-v-a64c8843"]]);export{kt as default};
